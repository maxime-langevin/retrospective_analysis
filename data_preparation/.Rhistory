breaks=report_dates$place,
labels=format(report_dates$report, format="%b %d, %Y"),
limits = c(as.Date("2021-01-01"), as.Date("2022-02-12"))
) +
theme(
axis.text.x = element_text(angle = 45, hjust=1),
axis.ticks.x=element_blank()
)
ggplot(ME) +
geom_point(
aes(report, median)
) +
geom_errorbar(
aes(x = report, ymin = optimist, ymax = pessimist),
width=.2
) +
facet_wrap(vars(variable), nrow = 2, scales = "free_x") +
ylim(-100, 100) + #dates of reports on x axis
#dates of reports on x axis
geom_rug(data = report_dates, aes(report)) +
#dates of reports on x axis
scale_x_continuous(
breaks=report_dates$place,
labels=format(report_dates$report, format="%b %d, %Y"),
limits = c(as.Date("2021-01-01"), as.Date("2022-02-12"))
) +
theme(
axis.text.x = element_text(angle = 45, hjust=1),
axis.ticks.x=element_blank()
)
ggplot(ME) +
geom_point(
aes(report, median)
) +
geom_errorbar(
aes(x = report, ymin = optimist, ymax = pessimist),
width=.2
) +
facet_wrap(vars(variable), nrow = 2) +
ylim(-100, 100) + #dates of reports on x axis
#dates of reports on x axis
geom_rug(data = report_dates, aes(report)) +
#dates of reports on x axis
scale_x_continuous(
breaks=report_dates$place,
labels=format(report_dates$report, format="%b %d, %Y"),
limits = c(as.Date("2021-01-01"), as.Date("2022-02-12"))
) +
theme(
axis.text.x = element_text(angle = 45, hjust=1),
axis.ticks.x=element_blank()
)
ggplot(ME) +
geom_point(
aes(report, median)
) +
geom_errorbar(
aes(x = report, ymin = optimist, ymax = pessimist),
width=.2
) +
facet_wrap(vars(variable), nrow = 2) +
ylim(-100, 100) + #dates of reports on x axis
#dates of reports on x axis
scale_x_continuous(
breaks=report_dates$place,
labels=format(report_dates$report, format="%b %d, %Y"),
limits = c(as.Date("2021-01-01"), as.Date("2022-02-12"))
) +
theme(
axis.text.x = element_text(angle = 45, hjust=1),
axis.ticks.x=element_blank()
)
ggplot(ME) +
geom_point(
aes(report, median)
) +
geom_errorbar(
aes(x = report, ymin = optimist, ymax = pessimist),
width=.2
) +
facet_wrap(vars(variable), nrow = 2) +
ylim(-100, 100) + #dates of reports on x axis
#dates of reports on x axis
scale_x_continuous(
breaks=report_dates$place,
labels=format(report_dates$report, format="%b %d, %Y")
) +
theme(
axis.text.x = element_text(angle = 45, hjust=1),
axis.ticks.x=element_blank()
)
#date of the reports
report_dates <- data_frame(
report = unique(as.Date(data_new_hosp$report)),
place = report #to loaclize on x axis
)
#small offset to position summer 2021 reports
report_dates$place[report_dates$place=="2021-07-26"] <- report_dates$place[report_dates$place=="2021-07-26"]-15
report_dates$place[report_dates$place=="2021-08-05"] <- report_dates$place[report_dates$place=="2021-08-05"]+15
#small offset to position summer 2021 reports
report_dates$place[report_dates$place=="2021-07-26"] <- report_dates$place[report_dates$place=="2021-07-26"]-10
report_dates$place[report_dates$place=="2021-08-05"] <- report_dates$place[report_dates$place=="2021-08-05"]+3
#small offset to position winter 2021 reports
report_dates$place[report_dates$place=="2021-01-16"] <- report_dates$place[report_dates$place=="2021-01-16"]-10
report_dates$place[report_dates$place=="2021-02-02"] <- report_dates$place[report_dates$place=="2021-02-02"]-5
report_dates$place[report_dates$place=="2021-02-08"] <- report_dates$place[report_dates$place=="2021-02-08"]+10
report_dates$place[report_dates$place=="2021-02-23"] <- report_dates$place[report_dates$place=="2021-02-23"]+15
View(report_dates)
#date of the reports
report_dates <- data_frame(
report = unique(as.Date(data_new_hosp$report)),
place = report #to localize on x axis
)
#date of the reports
report_dates <- data_frame(
report = unique(as.Date(ME$report)),
place = report #to localize on x axis
)
#small offset to position summer 2021 reports
report_dates$place[report_dates$place=="2021-07-26"] <- report_dates$place[report_dates$place=="2021-07-26"]-15
report_dates$place[report_dates$place=="2021-08-05"] <- report_dates$place[report_dates$place=="2021-08-05"]+15
#small offset to position summer 2021 reports
report_dates$place[report_dates$place=="2021-07-26"] <- report_dates$place[report_dates$place=="2021-07-26"]-10
report_dates$place[report_dates$place=="2021-08-05"] <- report_dates$place[report_dates$place=="2021-08-05"]+3
#small offset to position winter 2021 reports
report_dates$place[report_dates$place=="2021-01-16"] <- report_dates$place[report_dates$place=="2021-01-16"]-10
report_dates$place[report_dates$place=="2021-02-02"] <- report_dates$place[report_dates$place=="2021-02-02"]-5
report_dates$place[report_dates$place=="2021-02-08"] <- report_dates$place[report_dates$place=="2021-02-08"]+10
report_dates$place[report_dates$place=="2021-02-23"] <- report_dates$place[report_dates$place=="2021-02-23"]+15
#date of the reports
report_dates <- data_frame(
report = unique(as.Date(ME$report)),
place = report #to localize on x axis
)
#small offset to position summer 2021 reports
report_dates$place[report_dates$place=="2021-07-26"] <- report_dates$place[report_dates$place=="2021-07-26"]-10
report_dates$place[report_dates$place=="2021-08-05"] <- report_dates$place[report_dates$place=="2021-08-05"]+3
#small offset to position winter 2021 reports
report_dates$place[report_dates$place=="2021-01-16"] <- report_dates$place[report_dates$place=="2021-01-16"]-10
report_dates$place[report_dates$place=="2021-02-02"] <- report_dates$place[report_dates$place=="2021-02-02"]-5
report_dates$place[report_dates$place=="2021-02-08"] <- report_dates$place[report_dates$place=="2021-02-08"]+10
report_dates$place[report_dates$place=="2021-02-23"] <- report_dates$place[report_dates$place=="2021-02-23"]+15
ggplot(ME) +
geom_point(
aes(report, median)
) +
geom_errorbar(
aes(x = report, ymin = optimist, ymax = pessimist),
width=.2
) +
facet_wrap(vars(variable), nrow = 2) +
ylim(-100, 100) + #dates of reports on x axis
#dates of reports on x axis
scale_x_continuous(
breaks=report_dates$place,
labels=format(report_dates$report, format="%b %d, %Y")
) +
theme(
axis.text.x = element_text(angle = 45, hjust=1),
axis.ticks.x=element_blank()
)
ggplot(ME) +
geom_point(
aes(report, median)
) +
geom_errorbar(
aes(x = report, ymin = optimist, ymax = pessimist),
width=.2
) +
facet_wrap(vars(variable), nrow = 2) +
ylim(-100, 100) + #dates of reports on x axis
#dates of reports on x axis
scale_x_continuous(
breaks=report_dates$place,
labels=format(report_dates$report, format="%b %d, %Y")
) +
theme(
axis.text.x = element_text(angle = 45, hjust=1),
axis.ticks.x=element_blank()
) +
geom_hline(yintercept = 0)
ggplot(ME) +
geom_point(
aes(report, median)
) +
geom_errorbar(
aes(x = report, ymin = optimist, ymax = pessimist),
width=.2
) +
facet_wrap(vars(variable), nrow = 2) +
ylim(-100, 100) + #dates of reports on x axis
#dates of reports on x axis
scale_x_continuous(
breaks=report_dates$place,
labels=format(report_dates$report, format="%b %d, %Y")
) +
theme(
axis.text.x = element_text(angle = 45, hjust=1),
axis.ticks.x=element_blank()
) +
geom_hline(yintercept = 0, linetype = "dashed", alpha=.5)
ME <- ME %>%
mutate(
modellers_asses = case_when(
report %in% c("2021-05-21") ~ "yes",
T~"no"
)
)
View(ME)
ME <- ME %>%
mutate(
modellers_asses = case_when(
report %in% as.Date(c("2021-05-21")) ~ "yes",
T~"no"
)
)
ME <- ME %>%
mutate(
modellers_asses = case_when(
report %in% c("2021-05-21") ~ "yes",
T~"no"
)
)
#graph
ggplot(ME) +
geom_point(
aes(report, median)
) +
geom_errorbar(
aes(x = report, ymin = optimist, ymax = pessimist),
width=.2
) +
facet_wrap(vars(variable), nrow = 2) +
ylim(-100, 100) + #dates of reports on x axis
#dates of reports on x axis
scale_x_continuous(
breaks=report_dates$place,
labels=format(report_dates$report, format="%b %d, %Y")
) +
theme(
axis.text.x = element_text(angle = 45, hjust=1),
axis.ticks.x=element_blank()
) +
geom_hline(yintercept = 0, linetype = "dashed", alpha=.5) +
kabs(
x="report date", y="mean error, % of historical peak",
subtitle = "point: median scenario ; error bar: range of all scenarios"
)
#graph
ggplot(ME) +
geom_point(
aes(report, median)
) +
geom_errorbar(
aes(x = report, ymin = optimist, ymax = pessimist),
width=.2
) +
facet_wrap(vars(variable), nrow = 2) +
ylim(-100, 100) + #dates of reports on x axis
#dates of reports on x axis
scale_x_continuous(
breaks=report_dates$place,
labels=format(report_dates$report, format="%b %d, %Y")
) +
theme(
axis.text.x = element_text(angle = 45, hjust=1),
axis.ticks.x=element_blank()
) +
geom_hline(yintercept = 0, linetype = "dashed", alpha=.5) +
labs(
x="report date", y="mean error, % of historical peak",
subtitle = "point: median scenario ; error bar: range of all scenarios"
)
#RMSE Mean Error for each ICU report (optimist, median and pessimist scenario)
rmse_ICU <- data_ICU_error %>%
group_by(report) %>%
filter(date>report) %>%
summarise(
optimist =  round(sqrt(sum(error_min^2)/length(which(!is.na(error_min))))),
median =  round(sqrt(sum(error_med^2)/length(which(!is.na(error_med))))),
pessimist =  round(sqrt(sum(error_max^2)/length(which(!is.na(error_max)))))
)
#RMSE Mean Error for each hospital admissions report (optimist, median and pessimist scenario)
rmse_hosp <- data_new_hosp_error %>%
group_by(report) %>%
filter(date>report) %>%
summarise(
optimist =  round(sqrt(sum(error_min^2)/length(which(!is.na(error_min))))),
median =  round(sqrt(sum(error_med^2)/length(which(!is.na(error_med))))),
pessimist =  round(sqrt(sum(error_max^2)/length(which(!is.na(error_max)))))
)
#combine ICU and hospital admissions RMSE
rmse <- bind_rows(
rmse_ICU %>% mutate(variable = "ICU"),
rmse_hosp %>% mutate(variable = "hospital admissions")
) %>%
mutate(report = as.Date(report))
rm(rmse_ICU, rmse_hosp)
#date of the reports, to position on the graph
report_dates <- data_frame(
report = unique(as.Date(ME$report)),
place = report #to localize on x axis
)
#small offset to position summer 2021 reports
report_dates$place[report_dates$place=="2021-07-26"] <- report_dates$place[report_dates$place=="2021-07-26"]-10
report_dates$place[report_dates$place=="2021-08-05"] <- report_dates$place[report_dates$place=="2021-08-05"]+3
#small offset to position winter 2021 reports
report_dates$place[report_dates$place=="2021-01-16"] <- report_dates$place[report_dates$place=="2021-01-16"]-10
report_dates$place[report_dates$place=="2021-02-02"] <- report_dates$place[report_dates$place=="2021-02-02"]-5
report_dates$place[report_dates$place=="2021-02-08"] <- report_dates$place[report_dates$place=="2021-02-08"]+10
report_dates$place[report_dates$place=="2021-02-23"] <- report_dates$place[report_dates$place=="2021-02-23"]+15
#graph
ggplot(rmse) +
geom_point(
aes(report, median)
) +
geom_errorbar(
aes(x = report, ymin = optimist, ymax = pessimist),
width=.2
) +
facet_wrap(vars(variable), nrow = 1) +
ylim(0, 100) +
#dates of reports on x axis
scale_x_continuous(
breaks=report_dates$place,
labels=format(report_dates$report, format="%b %d, %Y")
) +
theme(
axis.text.x = element_text(angle = 45, hjust=1),
axis.ticks.x=element_blank()
) +
geom_hline(yintercept = 0, linetype = "dashed", alpha=.5) +
labs(
x="report date", y="mean error, % of historical peak",
subtitle = "point: median scenario       error bar: range of all scenarios"
)
#graph
ggplot(rmse) +
geom_point(
aes(report, median)
) +
geom_errorbar(
aes(x = report, ymin = optimist, ymax = pessimist),
width=.2
) +
facet_wrap(vars(variable), nrow = 2) +
ylim(0, 100) +
#dates of reports on x axis
scale_x_continuous(
breaks=report_dates$place,
labels=format(report_dates$report, format="%b %d, %Y")
) +
theme(
axis.text.x = element_text(angle = 45, hjust=1),
axis.ticks.x=element_blank()
) +
geom_hline(yintercept = 0, linetype = "dashed", alpha=.5) +
labs(
x="report date", y="mean error, % of historical peak",
subtitle = "point: median scenario       error bar: range of all scenarios"
)
#graph
ggplot(rmse) +
geom_point(
aes(report, median)
) +
geom_errorbar(
aes(x = report, ymin = optimist, ymax = pessimist),
width=.2
) +
facet_wrap(vars(variable), nrow = 2) +
ylim(0, 100) +
#dates of reports on x axis
scale_x_continuous(
breaks=report_dates$place,
labels=format(report_dates$report, format="%b %d, %Y")
) +
theme(
axis.text.x = element_text(angle = 45, hjust=1),
axis.ticks.x=element_blank()
) +
labs(
x="report date", y="mean error, % of historical peak",
subtitle = "point: median scenario       error bar: range of all scenarios"
)
View(data_ICU_error)
View(data_ICU_beds)
View(data_ICU_error)
temp <- left_join(
data_ICU_error,
data_ICU_beds %>% select(report = report_date, error_dummy),
by = "report"
)
#ICU data
data_ICU_error <- bind_rows(
f_read_ICU_error("2020_04_28"),
f_read_ICU_error("2020_10_30"),
f_read_ICU_error("2021_05_21"),
f_read_ICU_error("2021_07_26"),
f_read_ICU_error("2021_08_05"),
f_read_ICU_error("2022_01_07")
)
temp <- left_join(
data_ICU_error,
data_ICU_beds %>% select(report = report_date, error_dummy),
by = "report"
)
temp <- left_join(
data_ICU_error,
data_ICU_beds %>% select(report_date, error_dummy),
by = "report"
)
temp <- left_join(
data_ICU_error,
data_ICU_beds %>% select(report_date = report, error_dummy),
by = "report"
)
data_ICU_beds %>% select(report = report_date, error_dummy)
data_ICU_error
temp <- left_join(
data_ICU_error,
data_ICU_beds %>% select(report = report_date, error_dummy) %>% distinct(),
by = "report"
)
data_ICU_beds %>% select(report = report_date, error_dummy) %>% distinct()
data_ICU_error
temp <- left_join(
data_ICU_error,
data_ICU_beds %>% select(report = report_date, error_dummy) %>% distinct(),
by = "report"
)
path_source <- "output_data/min_med_max_and_error/"
f_read_ICU_error <- function(date_scenario){
#get scenario data, add report ID
data <- read_csv(
paste0(path_source, "ICU_error/", date_scenario, "_ICU_error.csv")
) %>%
mutate(report = gsub("_", "-", date_scenario))
data <- data %>% select(report, date, error_min, error_med, error_max) %>%
filter(
is.na(error_min)==F & is.na(error_med)==F & is.na(error_max)==F
) %>%
mutate(
days_since_publication = as.Date(date)-as.Date(report)
)
return(data)
}
f_read_new_hosp_error <- function(date_scenario){
#get scenario data, add report ID
data <- read_csv(
paste0(path_source, "new_hosp_error/", date_scenario, "_new_hosp_error.csv")
) %>%
mutate(report = gsub("_", "-", date_scenario))
data <- data %>% select(report, date, error_min, error_med, error_max) %>%
filter(
is.na(error_min)==F & is.na(error_med)==F & is.na(error_max)==F
) %>%
mutate(
days_since_publication = as.Date(date)-as.Date(report)
)
return(data)
}
#ICU data
data_ICU_error <- bind_rows(
f_read_ICU_error("2020_04_28"),
f_read_ICU_error("2020_10_30"),
f_read_ICU_error("2021_05_21"),
f_read_ICU_error("2021_07_26"),
f_read_ICU_error("2021_08_05"),
f_read_ICU_error("2022_01_07")
)
temp <- left_join(
data_ICU_error,
data_ICU_beds %>% select(report = report_date, error_dummy) %>% distinct(),
by = "report"
)
#new hosp data
data_new_hosp_error <- bind_rows(
f_read_new_hosp_error("2021_01_16"),
f_read_new_hosp_error("2021_02_02"),
f_read_new_hosp_error("2021_02_08"),
f_read_new_hosp_error("2021_02_23"),
f_read_new_hosp_error("2021_04_26"),
f_read_new_hosp_error("2021_05_21"),
f_read_new_hosp_error("2021_07_26"),
f_read_new_hosp_error("2021_08_05"),
f_read_new_hosp_error("2021_10_04"),
f_read_new_hosp_error("2022_01_07")
)
temp <- left_join(
data_ICU_error,
data_ICU_beds %>% select(report = report_date, error_dummy) %>% distinct(),
by = "report"
)
temp <- inner_join(
data_ICU_error,
data_ICU_beds %>% select(report = report_date, error_dummy) %>% distinct(),
by = "report"
)
temp2 <- data_ICU_beds %>% select(report = report_date, error_dummy) %>% distinct()
temp <- inner_join(
data_ICU_error,
temp2,
by = "report"
)
View(temp2)
temp2 <- data_ICU_beds %>% select(report = report_date, error_dummy) %>% distinct()
temp <- inner_join(
data_ICU_error,
temp2,
by = "report"
)
